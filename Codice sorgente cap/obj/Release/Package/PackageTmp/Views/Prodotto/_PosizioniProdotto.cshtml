@model IZSLER_CAP.Models.ProdottoModel
@*@{Layout = "~/Views/Shared/_LayoutClear.cshtml";}*@
@using IZSLER_CAP.Helpers
@functions 
{
    //Ric#3
    int profilo_id;
    //Ric#3
    public int profil_id()
    {
        profilo_id = @Html.GetUserProfileID();
        return profilo_id;
    }
    //Ric#3
    int utente;
    //Ric#3
    public int utente_id()
    {
        utente = @Html.GetUserID();
        return utente;
    }
    
    //sim04
    protected LoadEntities m_le = new LoadEntities();
    public List<MyFase> ListaFasi = new List<MyFase>();
    List<MyUdM> ListaUdm = new List<MyUdM>();
    
    //sim04
    public string PopolaFasi()
    {
        ListaFasi = m_le.GetFasiDelProdotto(Model.Prodotto.Prodot_ID);
        return "";
    }

    //sim04
    public IEnumerable<SelectListItem> ListaFasiSL(int? Fase_id)
    {
        return m_le.ListMyFaseToSLI(ListaFasi, Fase_id, true);
    }
    
    public string PopolaUdM()
    {
        ListaUdm = m_le.GetElencoUDMVisible();
        return "";
    }

    public IEnumerable<SelectListItem> ListaUdMSL(int? UdM_id)
    {
        return m_le.ListMyUdMToSLI(ListaUdm, UdM_id, true);        
    }
    
    private int counterPos = 0;
    public string CounterValue()
    {
        counterPos++;
        return counterPos.ToString();
    }
    public string getIntValue(int? val)
    {
        if (val.HasValue)
            return val.Value.ToString();
        return "0";
    }
    public string contact(string name_id, int id)
    {
        return name_id + "_" + id.ToString();
    }

    public string SetImporto(decimal? val)
    {
        if (val.HasValue)
        { return val.Value.ToString().Replace(".", ","); }
        return "0,00";
    }
    public string IsEditableString()
    {
        if (IsEditable) return "";
        return "disabled";
    }
    public bool IsNotAccettazione(int? Fase_ID)
    {
        bool lret = true;
        if (Fase_ID.HasValue && Fase_ID.Value == 1) lret = false;
        return lret;
    }
    
    //Ric#3
    bool IsEditable;
    public bool IsEditable_function()
    {
        //if (!Model.Prodotto.Prodot_Flg_Bloccato)
        //Ric#3
        if (!Model.Prodotto.Prodot_Flg_Bloccato && IsAssociato(@Model.Prodotto.Prodot_utente_id, Model.Prodotto.Prodot_flg_assegn_al_gruppo))
        {
            if (Html.IsEditableStato(Model.Prodotto))
            {
                IsEditable = true;
                return true;
            }
            //if(Model.Analisi.Analisi_T_Staval_id==2 ||Model.Analisi.Analisi_T_Staval_id==7)
            //return true;
            
        }
        IsEditable = false;
        return false;
    }
    public string GetConversione(double? val) 
    {
        if (val.HasValue)
        { return val.Value.ToString(); }
        return "";
    }

    //Ric#3
    public bool IsAssociato(int? Utente_id, bool? Prodotto_flg_assegn_al_gruppo)
    {
        if (Prodotto_flg_assegn_al_gruppo == true)
        {
            return true;
        }
        if (Utente_id == utente)
        {
            return true;
        }
        //int profilo_id = @Html.GetUserProfileID();
        if (profilo_id == 3 || profilo_id == 4 || profilo_id == 7)
        {
            return true;
        }

        return false;
    }
   
    //Ric#3
    public string PopolaVariabili()
    {
        utente_id();
        profil_id();
        IsEditable_function();
        PopolaFasi();
        PopolaUdM();
        return "";
    }
    
}


<script type="text/javascript">
    $(document).ready
    (
        function () {
            $('img[id^="imgUdM_"]').each(function () {

                var pos = $(this)[0].id.replace("imgUdM_", "");
                checkUDM(pos);
            });
            //    $('#Fase_1').change(function () { alert(1); });
            /*cambia la Fase*/
            $('select[id^="Fase_"]').change
            (
                function () {
                    var pos = $(this)[0].id.replace("Fase_", "");
                    var idDept = $(this).val();
                    var prodotto_idVal = $('#prodotto_id').val();
                    var ProdottoPos_Analisi_desc = '#ProdottoPos_Analisi_desc_' + pos;
                    var val_ProdottoPos_Analisi_desc = $(ProdottoPos_Analisi_desc).text();
                    var ProdottoPos_Prodotto_Desc = "#ProdottoPos_Prodotto_Desc_" + pos;
                    var val_ProdottoPos_Prodotto_Desc = $(ProdottoPos_Prodotto_Desc).text();

                    var ProdottoPos_Macchinario_Desc = '#ProdottoPos_Macchinario_Desc_' + pos;
                    var val_ProdottoPos_Macchinario_Desc = $(ProdottoPos_Macchinario_Desc).text();
                    // manca prodotto
                    var flgPulisciCosto = true;
                    if ((val_ProdottoPos_Analisi_desc != null && val_ProdottoPos_Analisi_desc != "")
                        || (val_ProdottoPos_Prodotto_Desc != null && val_ProdottoPos_Prodotto_Desc != "")
                        || (val_ProdottoPos_Macchinario_Desc != null && val_ProdottoPos_Macchinario_Desc != "")
                        ) {
                        flgPulisciCosto = false;
                    }

                    var imgAnalisi = $("#ProdottoPos_Analisi_img_" + pos);
                    var imgProdotto = $("#ProdottoPos_Prodotto_img_" + pos);
                    var imgMacchinario = $("#ProdottoPos_Macchinario_img_" + pos);

                    var Fase_Val = '#Fase_' + pos;
                    var textSelVal = $(Fase_Val + ' :selected').text();
                    //if (idDept == 1)  // Fase == "Accettazione"
                    if (textSelVal == "Accettazione")
                    {
                        imgAnalisi.hide();
                        imgProdotto.hide();
                        imgMacchinario.hide();
                        $(ProdottoPos_Analisi_desc).text("");
                        $(ProdottoPos_Prodotto_Desc).text("");
                        $(ProdottoPos_Macchinario_Desc).text("");
                        $.getJSON
                       (
                            "/Prodotto/GetImportoFaseAccettazione",
                            { prodotto_id: prodotto_idVal, Attivi_id: idDept, valpos_id: pos },
                            function (myData) {
                                var select = $('#FigProf_' + pos);
                                $('#FigProf_' + pos).find('option').remove().end();
                                select.empty();
                                $.each(myData,
                                           function (index, itemData) {
                                               //alert(itemData.Text);
                                               var Costo_Unitario = "#Costo_Unitario_" + pos;
                                               $(Costo_Unitario).val(itemData.Text);
                                               updateCostoTotale(pos);

                                               var emp =
                                                {
                                                    TipoSalvataggio: "FaseAccettazione",
                                                    ProdottoPos_id: pos,
                                                    ProdottoPos_Fase_id: idDept,
                                                    ProdottoPos_QuantitaCosto: itemData.Text
                                                };
                                                var urlSave = '/Prodotto/SaveValPos';
                                               $.ajax({
                                                   type: "POST",
                                                   url: urlSave,
                                                   data: JSON.stringify(emp),
                                                   datatype: "JSON",
                                                   contentType: "application/json; charset=utf-8",
                                                   success: function (retdata) {
                                                       if (!retdata.ok) {
                                                           showAlertErrorGeneric(retdata.infopersonali, 'Attenzione');
                                                       }

                                                   }
                                               });
                                               var lUDM = "#UdM_" + pos;
                                               $(lUDM).val('25'); // imposto udm a "Numero"
                                               //$(lUDM).val('13'); // imposto udm a minuti
                                               $('#UdMOLD_' + pos).val($('#UdM_' + pos).val()); // imposta il nuovo valore del UDM dll nella var UDM_OLD
                                           }
                                       );
                            }
                         );
                    }
                    else // Fase diversa da != "Accettazione"
                    {
                        imgAnalisi.show();
                        imgProdotto.show();
                        imgMacchinario.show();
                        $.getJSON
                        (
                            "/Prodotto/GetElencoFigProfessionali",
                            { prodotto_id: prodotto_idVal, Attivi_id: idDept, valpos_id: pos },
                            function (myData) {
                                var select = $('#FigProf_' + pos);
                                $('#FigProf_' + pos).find('option').remove().end();
                                select.empty();
                                $.each(myData,
                                            function (index, itemData) {
                                                select.append($('<option/>',
                                                { value: itemData.Value, text: itemData.Text }));
                                            }
                                        );
                            }
                         );
                    }
                    var idUDM_ID = 0;
                    if (
                        (val_ProdottoPos_Analisi_desc == null || val_ProdottoPos_Analisi_desc == "")
                        && (val_ProdottoPos_Prodotto_Desc == null || val_ProdottoPos_Prodotto_Desc == "")
                        && (val_ProdottoPos_Macchinario_Desc == null || val_ProdottoPos_Macchinario_Desc != "")
                       )
                   {
                        var lUDM = "#UdM_" + pos;
                        idUDM_ID = 25;
                        //idUDM_ID = 13;
                        $(lUDM).val('25'); // imposto udm a "Numero"
                        //$(lUDM).val('13'); // imposto udm a minuti
                        $('#UdMOLD_' + pos).val($('#UdM_' + pos).val()); // imposta il nuovo valore del UDM dll nella var UDM_OLD
                    }
                    var emp =
                    {
                        TipoSalvataggio: "Fase",
                        ProdottoPos_id: pos,
                        ProdottoPos_Fase_id: idDept,
                        ProdottoPos_UdM_id: idUDM_ID
                    };
                    var urlSave = '/Prodotto/SaveValPos';
                    $.ajax({
                        type: "POST",
                        url: urlSave,
                        data: JSON.stringify(emp),
                        datatype: "JSON",
                        contentType: "application/json; charset=utf-8",
                        success: function (retdata) {
                            if (!retdata.ok) {
                                showAlertErrorGeneric(retdata.infopersonali, 'Attenzione');
                            }

                        }
                    });
                    if (flgPulisciCosto) {
                        var Costo_Unitario = "#Costo_Unitario_" + pos;
                        //$(Costo_Unitario).text("0,00");
                        $(Costo_Unitario).val("0,00");
                        updateCostoTotale(pos); // $(Costo_Unitario).change();
                        var empClearCosto =
                        { TipoSalvataggio: "PulisciCosto",
                            ProdottoPos_id: pos,
                            ProdottoPos_QuantitaCosto: 0
                        }
                        var urlSave = '/Prodotto/SaveValPos';
                        $.ajax({
                            type: "POST",
                            url: urlSave,
                            data: JSON.stringify(empClearCosto),
                            datatype: "JSON",
                            contentType: "application/json; charset=utf-8",
                            success: function (retdata) {
                                if (!retdata.ok) {
                                    showAlertErrorGeneric(retdata.infopersonali, 'Attenzione');
                                }

                            }
                        });
                    }
                }
           );
            /*cambia il livello*/
            $('select[id^="FigProf_"]').change
            (
                function () {
                    var pos = $(this)[0].id.replace("FigProf_", "");
                    var tmp_NewVal = $(this).val();
                    var n = tmp_NewVal.split('|');
                    var newVal = n[0];
                    var costo = "0,00";
                    if (n.length == 2)
                        costo = n[1];
                    // var analisi_idVal = $('#analisi_id').val();

                    var ProdottoPos_Analisi_desc = '#ProdottoPos_Analisi_desc_' + pos;
                    var ProdottoPos_Prodotto_Desc = '#ProdottoPos_Prodotto_Desc_' + pos;
                    var ProdottoPos_Prodotto_id = '#ProdottoPos_Prodotto_id_' + pos;
                    var ProdottoPos_Prodotto_UDM_ID = '#ProdottoPos_Prodotto_UDM_ID_' + pos;
                    var ProdottoPos_Macchinario_Desc = '#ProdottoPos_Macchinario_Desc_' + pos;

                    var Costo_Unitario = "#Costo_Unitario_" + pos;
                    //$(Costo_Unitario).text(costo);
                    $(Costo_Unitario).val(costo);

                    $(ProdottoPos_Analisi_desc).text("");
                    $(ProdottoPos_Prodotto_Desc).text("");
                    $(ProdottoPos_Prodotto_id).val("");
                    $(ProdottoPos_Prodotto_UDM_ID).val("");
                    $(ProdottoPos_Macchinario_Desc).text("");

                    var UdMCoeff = '#UdMCoeff_' + pos;
                    var udmRatio = "1";
                    $(UdMCoeff).val(udmRatio)


                    var idUDM_ID = 0;
                    var lUDM = "#UdM_" + pos;
                    //idUDM_ID = 25;
                    idUDM_ID = 13;
                    //$(lUDM).val('25'); // imposto udm a "Numero"
                    $(lUDM).val('13'); // imposto udm a minuti
                    updateCostoTotale(pos); // $(Costo_Unitario).change();


                    var emp =
                    {
                        TipoSalvataggio: "Livello",
                        ProdottoPos_id: pos,
                        ProdottoPos_FigProf_id: newVal,
                        ProdottoPos_QuantitaCosto: costo,
                        ProdottoPos_UdM_id: idUDM_ID
                    };
                    var urlSave = '/Prodotto/SaveValPos';
                    $.ajax({
                        type: "POST",
                        url: urlSave,
                        data: JSON.stringify(emp),
                        datatype: "JSON",
                        contentType: "application/json; charset=utf-8",
                        success: function (retdata) {
                            if (!retdata.ok) {
                                showAlertErrorGeneric(retdata.infopersonali, 'Attenzione');
                            }
                        }
                    });
                }
            );

            /*cambia la udm*/
            $('select[id^="UdM_"]').change
            (
                function () {
                    var pos = $(this)[0].id.replace("UdM_", "");
                    var newVal = $(this).val();
                    var UdMCoeff = '#UdMCoeff_' + pos;
                    var ProdUDM = '#ProdottoPos_Prodotto_UDM_ID_' + pos;
                    var valProdUDM = $(ProdUDM).val();

                    //var analisi_idVal = $('#analisi_id').val();
                    var emp =
                    {
                        TipoSalvataggio: "UdM",
                        ProdottoPos_id: pos,
                        ProdottoPos_UdM_id: newVal
                    };

                    if (valProdUDM != "") {
                        if (valProdUDM == newVal)  // se il prodotto ha udm come quella selezionata
                        {
                            $(UdMCoeff).val("1");
                            emp =
                            {
                                TipoSalvataggio: "UdM",
                                ProdottoPos_id: pos,
                                ProdottoPos_UdM_id: newVal,
                                ProdottoPos_CoeffConversioneString: "1"
                            };
                        }
                        else {
                            $(UdMCoeff).val("");
                            emp =
                            {
                                TipoSalvataggio: "UdM",
                                ProdottoPos_id: pos,
                                ProdottoPos_UdM_id: newVal,
                                ProdottoPos_CoeffConversioneString: "clear"
                            };
                        }
                    }


                    var ProdottoPos_Analisi_desc = '#ProdottoPos_Analisi_desc_' + pos;

                    var val_ProdottoPos_Analisi_desc = $(ProdottoPos_Analisi_desc).text();
                    var ProdottoPos_Prodotto_Desc = "#ProdottoPos_Prodotto_Desc_" + pos;
                    var val_ProdottoPos_Prodotto_Desc = $(ProdottoPos_Prodotto_Desc).text();

                    var ProdottoPos_Macchinario_Desc = '#ProdottoPos_Macchinario_Desc_' + pos;
                    var val_ProdottoPos_Macchinario_Desc = $(ProdottoPos_Macchinario_Desc).text();

                    val_ProdottoPos_Analisi_desc = $.trim(val_ProdottoPos_Analisi_desc);
                    val_ProdottoPos_Prodotto_Desc = $.trim(val_ProdottoPos_Prodotto_Desc);
                    val_ProdottoPos_Macchinario_Desc = $.trim(val_ProdottoPos_Macchinario_Desc);
                    var idUDM_ID = 0;

                    /*recupero variabili*/
                    var Fase_Val = '#Fase_' + pos;
                    var Fase_Val_desc = $(Fase_Val).val();
                    var FigProf_Val = '#FigProf_' + pos;
                    var FigProf_Val_desc = $(FigProf_Val).val();
                    var textSelVal = $(Fase_Val + ' :selected').text();
                    /*Controllo Accettazione*/
                    if ((textSelVal == "Accettazione") && (newVal == 25)) {
                        $('#UdMCoeff_' + pos).val("1");
                        emp =
                            {
                                TipoSalvataggio: "UdM",
                                ProdottoPos_id: pos,
                                ProdottoPos_UdM_id: newVal,
                                ProdottoPos_CoeffConversioneString: "1"
                            };
                    }
                    if ((textSelVal == "Accettazione") && (newVal != 25)) {
                        showAlertErrorGeneric('Unità di misura non permessa', 'Attenzione');
                        $('#UdM_' + pos).val($('#UdMOLD_' + pos).val()); // reimposta il vecchio valore del UDM dll
                        return;
                    }
                    /* FINE Controllo Accettazione*/

                    if ((textSelVal != "Accettazione")) {
                        /* Intermedi Analisi */
                        if ((val_ProdottoPos_Analisi_desc != null && val_ProdottoPos_Analisi_desc != "") && (newVal != 25)) {
                            showAlertErrorGeneric('Unità di misura non permessa', 'Attenzione');
                            $('#UdM_' + pos).val($('#UdMOLD_' + pos).val()); // reimposta il vecchio valore del UDM dll
                            return;
                        }
                        if ((val_ProdottoPos_Analisi_desc != null && val_ProdottoPos_Analisi_desc != "") && (newVal == 25)) {
                            $('#UdMCoeff_' + pos).val("1");
                            emp =
                            {
                                TipoSalvataggio: "UdM",
                                ProdottoPos_id: pos,
                                ProdottoPos_UdM_id: newVal,
                                ProdottoPos_CoeffConversioneString: "1"
                            };
                        }
                        /* Intermedi Analisi  FINE */

                        /* Macchinari */
                        if ((val_ProdottoPos_Macchinario_Desc != null && val_ProdottoPos_Macchinario_Desc != "") && (newVal != 13)) 
                        {
                            showAlertErrorGeneric('Unità di misura non permessa', 'Attenzione');
                            $('#UdM_' + pos).val($('#UdMOLD_' + pos).val()); // reimposta il vecchio valore del UDM dll
                            return;
                        }
                        if ((val_ProdottoPos_Macchinario_Desc != null && val_ProdottoPos_Macchinario_Desc != "") && (newVal == 13)) 
                        {
                            $('#UdMCoeff_' + pos).val("1");
                            emp =
                            {
                                TipoSalvataggio: "UdM",
                                ProdottoPos_id: pos,
                                ProdottoPos_UdM_id: newVal,
                                ProdottoPos_CoeffConversioneString: "1"
                            };
                        }
                        /* Macchinari FINE */
                        /*FigProf*/
                        if ((FigProf_Val_desc != "0") && (newVal != 13)) {
                            showAlertErrorGeneric('Unità di misura non permessa', 'Attenzione');
                            $('#UdM_' + pos).val($('#UdMOLD_' + pos).val()); // reimposta il vecchio valore del UDM dll
                            return;
                        }
                        if ((FigProf_Val_desc != "0") && (newVal == 13)) {
                            $('#UdMCoeff_' + pos).val("1");
                            emp =
                            {
                                TipoSalvataggio: "UdM",
                                ProdottoPos_id: pos,
                                ProdottoPos_UdM_id: newVal,
                                ProdottoPos_CoeffConversioneString: "1"
                            };
                        }
                        /*FigProf FINE */
                    }

                    /* Rimossa
                    if (
                        (val_ProdottoPos_Analisi_desc == null || val_ProdottoPos_Analisi_desc == "")
                        && (val_ProdottoPos_Prodotto_Desc == null || val_ProdottoPos_Prodotto_Desc == "")
                        && (val_ProdottoPos_Macchinario_Desc == null || val_ProdottoPos_Macchinario_Desc == "")
                       ) {
                        var Fase_Val = '#Fase_' + pos;
                        var Fase_Val_desc = $(Fase_Val).val();
                        var FigProf_Val = '#FigProf_' + pos;
                        var FigProf_Val_desc = $(FigProf_Val).val();
                        var textSelVal =	$(Fase_Val +' :selected').text();
						
                        if ((textSelVal  == "Accettazione" || FigProf_Val_desc != "0") && (newVal == 25 )) {
                            var lUDM = "#UdM_" + pos;
                            var lProdottoPos_CoeffConversioneString = "1"
                            if (newVal == 14) // ore
                            { lProdottoPos_CoeffConversioneString = "60" } // 1h = 60 min
                            if (newVal == 12) // Sec
                            { lProdottoPos_CoeffConversioneString = "0,01666" } // 1min = 60 sec ==> 1 sec = 0,01666 min
                            $('#UdMCoeff_' + pos).val(lProdottoPos_CoeffConversioneString);
                            emp =
                            {
                                TipoSalvataggio: "UdM",
                                ProdottoPos_id: pos,
                                ProdottoPos_UdM_id: newVal,
                                ProdottoPos_CoeffConversioneString: lProdottoPos_CoeffConversioneString
                            };
                        }
                        else {
                            showAlertErrorGeneric('Unità di misura non permessa', 'Attenzione');
                            $('#UdM_' + pos).val($('#UdMOLD_' + pos).val()); // reimposta il vecchio valore del UDM dll
                            return;
                        }
                    }
                    */
                    var urlSave = '/Prodotto/SaveValPos';
                    $.ajax({
                        type: "POST",
                        url: urlSave,
                        data: JSON.stringify(emp),
                        datatype: "JSON",
                        contentType: "application/json; charset=utf-8",
                        success: function (retdata) {
                            if (!retdata.ok) {
                                showAlertErrorGeneric(retdata.infopersonali, 'Attenzione');
                            }
                        }
                    });
                    //checkUDM(pos);
                    updateCostoTotale(pos);
                }
            );
            /*cambia la descrizione*/
            $('input[id^="ProdottoPos_Desc_"]').bind('blur', function () {
                var pos = $(this)[0].id.replace("ProdottoPos_Desc_", "");

                var newVal = $(this).val();

                var emp =
                {
                    TipoSalvataggio: "Descrizione",
                    ProdottoPos_id: pos,
                    ProdottoPos_desc: newVal
                };

                var urlSave = '/Prodotto/SaveValPos';
                $.ajax({
                    type: "POST",
                    url: urlSave,
                    data: JSON.stringify(emp),
                    datatype: "JSON",
                    contentType: "application/json; charset=utf-8",
                    success: function (retdata) {
                        if (!retdata.ok) {
                            showAlertErrorGeneric(retdata.infopersonali, 'Attenzione');
                        }
                    }
                });

                // alert("pos:" + pos + "<br>Descrizione:" + newVal);
            }
            );
            /*cambia la costoQuantita*/
            $('input[id^="Costo_Unitario_"]').bind('change', function () {
                var pos = $(this)[0].id.replace("Costo_Unitario_", "");

                var newVal = $(this).val();
                var Costo_Totale = "#Costo_Totale_" + pos;
                $(Costo_Totale).val(newVal);


            }
           );
            /*cambia la Quantita*/
            $('input[id^="ProdottoPos_Quantita_"]').bind('blur', function () {
                var pos = $(this)[0].id.replace("ProdottoPos_Quantita_", "");

                var lval = $(this).val();
                var newVal = parseFloat(lval);
                newVal = newVal.toFixed(5);
                newVal = newVal.replace(".", ",");

                var emp =
                {
                    TipoSalvataggio: "Quantita",
                    ProdottoPos_id: pos,
                    ProdottoPos_Quantita: newVal
                };
                var Costo_Unitario = "#Costo_Unitario_" + pos;
                updateCostoTotale(pos); // $(Costo_Unitario).change();
                var urlSave = '/Prodotto/SaveValPos';
                $.ajax({
                    type: "POST",
                    url: urlSave,
                    data: JSON.stringify(emp),
                    datatype: "JSON",
                    contentType: "application/json; charset=utf-8",
                    success: function (retdata) {
                        if (!retdata.ok) {
                            showAlertErrorGeneric(retdata.infopersonali, 'Attenzione');
                        }
                    }
                });
                // alert("pos:" + pos + "<br>Quantita:" + newVal);
            }
           );

            var anchorsAnalisi = $('a[id^="ProdottoPos_Analisi_img_"]');

            $.each(anchorsAnalisi,
                        function (index, anchor) {
                            var value = anchor.id;
                            var pos = value.replace("ProdottoPos_Analisi_img_", "");
                            var valFase = $('#Fase_' + pos).val();
                            if (valFase == "1") {
                                anchor.outerHTML = '<a id="ProdottoPos_Analisi_img_' + pos + '" href="javascript:openRicercaPPIntermProdotto(\'/Prodotto/PPIntermAnalisi/' + pos + '\',this)" title="ricerca" class="button" style="background-image:url(../../Content/img/fineFiles/16/magnify.png);width: 16px;height: 16px; display:block;float:right;padding-right:0px;padding-left:0px;display:none;"></a>';
                            }

                        }
                        );

            var anchorsProdotti = $('a[id^="ProdottoPos_Prodotto_img_"]');

            $.each(anchorsProdotti,
                        function (index, anchor) {
                            var value = anchor.id;
                            var pos = value.replace("ProdottoPos_Prodotto_img_", "");
                            var valFase = $('#Fase_' + pos).val();
                            if (valFase == "1") {
                                anchor.outerHTML = '<a id="ProdottoPos_Prodotto_img_' + pos + '" href="javascript:openRicercaPPProdottiP(\'/Prodotto/PPProdotti/' + pos + '\',this)" title="ricerca" class="button" style="background-image:url(../../Content/img/fineFiles/16/magnify.png);width: 16px;height: 16px; display:block;float:right;padding-right:0px;padding-left:0px;display:none;"></a>';
                            }

                        }
           );

            var anchorsMacchinari = $('a[id^="ProdottoPos_Macchinario_img_"]');

            $.each(anchorsMacchinari,
                        function (index, anchor) {
                            var value = anchor.id;
                            var pos = value.replace("ProdottoPos_Macchinario_img_", "");
                            var valFase = $('#Fase_' + pos).val();
                            if (valFase == "1") {
                                anchor.outerHTML = '<a id="ProdottoPos_Macchinario_img_' + pos + '" name="mac_' + pos + '" href="javascript:openRicercaPPMacchinarioP(\'/Prodotto/PPMacchinari/' + pos + '\',this)" title="ricerca" class="button" style="background-image:url(../../Content/img/fineFiles/16/magnify.png);width: 16px;height: 16px; display:block;float:right;padding-right:0px;padding-left:0px;display:none;"></a>';
                            }

                        }
           );
        }

    );

    function udmCoeffValOut(s) {
        $(s).removeTooltip();
    }

    //Vecchia Funzione
    function udmCoeffValInOld(s, pos_id) {
        var text = "";
        var textVal = $('#UdMCoeff_' + pos_id).val();
        text = "Coeff. di Conversione:" + textVal;
        if (textVal == "")
            text = "Coeff. di Conversione da impostare";
        //alert(text);
        $(s).tooltip(text);
    }

    //La nuova funzione non deve mostrare la frazione ma la scritta 1 ml = 600 cmq
    function udmCoeffValIn(s, pos_id, desc) {

        var visualizza = false;
        if ($('#ProdottoPos_Prodotto_id_' + pos_id).val() > 0)
            visualizza = true;

        if (!visualizza)
            return;


        var text = "";

        var textVal = $('#UdMCoeff_' + pos_id).val();
        var descUdm = $('#UdM_' + pos_id + ' option:selected').text();
        var descProdotto = $('#UdMProdotDesc_' + pos_id).val();

        var coeffDB = parseFloat(textVal.replace(",", "."));

        var valoreProdotto = "";
        var valoreUdmPosizione = "";

        if (coeffDB > 1) //Il valore della udm del prodotto è maggiore rispetto a quella della UDM della posizione
        {
            valoreProdotto = coeffDB;
            valoreUdmPosizione = 1;
        }
        else {
            valoreProdotto = 1;
            valoreUdmPosizione = 1 / coeffDB;
        }

        text = valoreProdotto + " " + descProdotto + " = " + valoreUdmPosizione + " " + descUdm;

        if (textVal == "")
            text = "Coeff. di Conversione da impostare";
        //alert(text);
        $(s).tooltip(text);

        //alert($('#UdMProdotDesc_' + pos_id).val());
    }

    function CstUnitCondIn(s, pos_id) {

        var textVal = $('#UdMCoeff_' + pos_id).val();
        var coeffDB = parseFloat(textVal.replace(",", "."));

        var visualizza = false;
        if ($('#ProdottoPos_Prodotto_id_' + pos_id).val() > 0 && coeffDB != 1)
            visualizza = true;

        if (!visualizza)
            return;

        var text = "";
        

        var textCst = $('#Costo_Unitario_' + pos_id).val();

        var descUdm = $('#UdM_' + pos_id + ' option:selected').text();


        var costo_unitario = parseFloat(textCst.replace(",", "."));

        var valoreCstUnitCond = "";

        valoreCstUnitCond = roundNumber(coeffDB * costo_unitario, 7);

        text = "il costo unitario per " + descUdm + " é " + valoreCstUnitCond.toString().replace(".", ",");

        $(s).tooltip(text);

    }


    function CstUnitCondOut(s) {
        $(s).removeTooltip();
    }

    function posDescOut(s) {
        $(s).removeTooltip();
    }

    function posDescIn(s, pos_id) {
        var text = "";
        var textVal = $('#ProdottoPos_Desc_' + pos_id).val();
        text = textVal;
        $(s).tooltip(text);

    }
   
    function checkUDM(posid) {
        /*cambia il prodotto_UDM*/

        var ProdUDM = '#ProdottoPos_Prodotto_UDM_ID_' + posid;
        var UdMCoeff = '#UdMCoeff_' + posid;
        var img = '#imgUdM_' + posid;
        var aUdM = '#aUdM_' + posid;
        var UdM = '#UdM_' + posid;
        var onm = '#onm_' + posid;
        var cstun = '#cstun_' + posid;
        var valProdUDM = $(ProdUDM).val();
        var valUdM = $(UdM).val();
        var valUdMCoeff = $(UdMCoeff).val();

        if (valUdMCoeff == "1" || valUdMCoeff == "") {
            $(onm).hide();
            $(cstun).hide();
        }

        if (valUdMCoeff != "1" && valUdMCoeff != "") {
            $(onm).show();
            $(cstun).show();
        }

        // se il coeff di conversione e' settatoa sono ok
        if (valUdMCoeff != "") 
        {
            $(img).hide();
            $(aUdM).hide();
            return; 
        }



        if (valProdUDM == "" || valProdUDM == valUdM)
        { $(img).hide(); $(aUdM).hide(); return; }

        if (valProdUDM != valUdM)
        { $(img).show(); ; $(aUdM).show(); }
    }


    function updateCostoTotale(posid) {
        checkUDM(posid);
        var Costo_Unitario = "#Costo_Unitario_" + posid;
        var Costo_Totale = "#Costo_Totale_" + posid;
        var ProdottoPos_Quantita = "#ProdottoPos_Quantita_" + posid;
        var val_CU = $(Costo_Unitario).val();
        var val_QTA = $(ProdottoPos_Quantita).val();
        val_CU = parseFloat(val_CU.replace(',', '.'));
        val_QTA = parseFloat(val_QTA.replace(',', '.'));
        
        $('#UdMOLD_' + posid).val($('#UdM_' + posid).val()); // imposta il nuovo valore del UDM dll nella var UDM_OLD
        
        var UdMCoeff = '#UdMCoeff_' + posid;
        var UdMCoeffVal = $(UdMCoeff).val();
        if (UdMCoeffVal == "") 
        {
            UdMCoeffVal = "0"
        }
        UdMCoeffVal = parseFloat(UdMCoeffVal.replace(',', '.'));
        

        var val_Tot = 0;
        val_Tot = roundNumber(val_CU, 5) * roundNumber(val_QTA, 5) * UdMCoeffVal;
        val_Tot = roundNumber(val_Tot, 5);


        var strTot = "";
        strTot = val_Tot.toFixed(5).toString();
        strTot = strTot.replace('.', ',');
        if (strTot.indexOf(',') == -1)
            strTot = strTot + ",00";
        $(Costo_Totale).val(strTot);

        calcolaTotaleCorrente();
    }
    function roundNumber(num, dec) {
        var result = Math.round(num * Math.pow(10, dec)) / Math.pow(10, dec);
        return result;
    }
    /*Nuova posizione*/
    function NuovaPosizione(prodot_id) {
        var prod_id = 0;
        prod_id = prodot_id;
        var emp =
        { ProdottoPos_MasterProdotto_id: prod_id };

        var urlSave = '/Prodotto/AddNewValPos';
        $.ajax({
            type: "POST",
            url: urlSave,
            data: JSON.stringify(emp),
            datatype: "JSON",
            contentType: "application/json; charset=utf-8",
            success: function (retdata) {
                if (!retdata.ok) {
                    showAlertErrorGeneric(retdata.infopersonali, 'Attenzione');
                }
                else {
                    //location.href = "/Prodotto/ProdottoEdit/" + prod_id;
                    window.location.hash = 'pos';
                    location.reload(true);
                }
            }
        });
    }
    /*Cancella tutte le posizioni*/
    function SvuotaPosizioni(prodot_id) {
        var prod_id = 0;
        prod_id = prodot_id;
        var emp =
        { ProdottoPos_MasterProdotto_id: prod_id };
        var urlSave = '/Prodotto/DeleteAllPos';


        var conf = $.modal.confirm;
        conf('Eliminare tutte le posizioni ?',
         function () {

            $.ajax({
                type: "POST",
                url: urlSave,
                data: JSON.stringify(emp),
                datatype: "JSON",
                contentType: "application/json; charset=utf-8",
                success: function (retdata) {
                    if (!retdata.ok) {
                        showAlertErrorGeneric(retdata.infopersonali, 'Attenzione');
                    }
                    else {
                        //location.href = "/Prodotto/ProdottoEdit/" + prod_id;
                        window.location.hash = 'pos';
                        location.reload(true);
                    }
                }
            });
        },
         function () { }
         );
    }
    /*Cancella le posizioni  selezionate*/
    function CancellaPosizioni(prodot_id) {
        var prod_id = 0;
        prod_id = prodot_id;
      
        var checked = [];
        $("input[name='multicheckSelect']:checked").each(function () {
            checked.push(parseInt($(this).val()));
        });
        var urlSave = '/Prodotto/DeleteSinglePos';

        var parms = { ProdottoPosIds: checked };

        if (checked.length == 0) {
            showAlertErrorGeneric('Selezionare almeno una posizione.', 'Attenzione');
            return;
        }
        var conf = $.modal.confirm;
        conf('Eliminare le posizioni selezionate? ',
         function () {
             $.ajax({
                 type: "POST",
                 url: urlSave,
                 data: JSON.stringify(parms),
                 datatype: "json",
                 contentType: "application/json; charset=utf-8",
                 success: function (retdata) {
                     if (!retdata.ok) {
                         showAlertErrorGeneric(retdata.infopersonali, 'Attenzione');
                     }
                     else {
                         //location.href = "/Prodotto/ProdottoEdit/" + prod_id;
                         window.location.hash = 'pos';
                         location.reload(true);
                     }
                 }
             });
         },
         function () { }
         );


         /*
        $.ajax({
            type: "POST",
            url: urlSave,
            data: JSON.stringify(parms),
            datatype: "json",
            contentType: "application/json; charset=utf-8",
            success: function (retdata) {
                if (!retdata.ok) {
                    showAlertErrorGeneric(retdata.infopersonali, 'Attenzione');
                }
                else {
                    location.href = "/Prodotto/ProdottoEdit/" + prod_id;
                }
            }
        });
        */
    }
    /*Clona le posizioni selezionate*/
    function CopiaPosizione(prodot_id) {
        var prod_id = 0;
        prod_id = prodot_id;
        var checked = [];
        $("input[name='multicheckSelect']:checked").each(function () {
            checked.push(parseInt($(this).val()));
        });
        var urlSave = '/Prodotto/ClonaPosizione';

        var parms = { ProdottoPosIds: checked };

        $.ajax({
            type: "POST",
            url: urlSave,
            data: JSON.stringify(parms),
            datatype: "json",
            contentType: "application/json; charset=utf-8",
            success: function (retdata) {
                if (!retdata.ok) {
                    showAlertErrorGeneric(retdata.infopersonali, 'Attenzione');
                }
                else {
                    //location.href = "/Prodotto/ProdottoEdit/" + prod_id;
                    window.location.hash = 'pos';
                    location.reload(true);
                }
            }
        });
    }
</script>
@PopolaVariabili()
 <p >
        
        @if (@IsEditable)
        {
            <a href="javascript:NuovaPosizione(@Model.Prodotto.Prodot_ID);" title="Nuova posizione" class="button icon-plus-round green-gradient glossy">Nuova posizione</a>
            <a href="javascript:CopiaPosizione(@Model.Prodotto.Prodot_ID);" title="Copia posizione" class="button icon-plus-round green-gradient glossy">Copia posizione</a>
            <a href="javascript:CancellaPosizioni(@Model.Prodotto.Prodot_ID);" title="Cancella posizione" class="button icon-plus-round red-gradient glossy">Cancella posizione</a>
            <a href="javascript:SvuotaPosizioni(@Model.Prodotto.Prodot_ID);" title="Elimina tutto" class="button icon-plus-round red-gradient glossy">Elimina tutto</a>
            <a href="javascript:openRicercaPPCopiaModello('/Prodotto/PPCopiaModelloProdotto/@Model.Prodotto.Prodot_ID?sec=0&p=1')" title="Crea da modello" class="button icon-plus-round orange-gradient glossy">Crea da modello</a>
        }
</p>
    <p class="button-height">
    @if (1 == 10)
    {<a href="#" title="Copia da valorizzazione" class="button icon-plus-round green-gradient glossy">Copia da valorizzazione</a>}
    @if (1 == 0)
    {<a href="#" title="Crea da modello" class="button icon-plus-round green-gradient glossy">Crea da modello</a>}
</p>
<div style="clear">
   
    
   <table class="table responsive-table" id="idTable">
        <thead>
            <tr>
                <th scope="col" width="10px" class="align-center">&nbsp;</th>
                <th scope="col" width="10%" class="align-center">Fase</th>
                <th scope="col" width="13%" class="align-center">Analisi /<br />Intermedio</th>
                <th scope="col" width="11%" class="align-center ">Prodotto</th>
                <th scope="col" width="10%" class="align-center ">Apparecchiatura dedicata</th>
		        <th scope="col" width="13%" class="align-center ">Fig.<br />professionale</th>
                <th scope="col" width="15%" class="align-center ">Descrizione</th>
                <th scope="col" width="10%" class="align-center ">Unit&agrave; di Misura</th>
                <th scope="col" width="6%" class="align-center ">Quantità</th>
                <th scope="col" width="6%" class="align-center hide-on-mobile">Costo Unitario</th>
                <th scope="col" width="6%" class="align-center hide-on-mobile">Costo Posizione</th>
            </tr>
        </thead>
        <tfoot>
		    <tr>
			    <td colspan="11">
				    @Model.ElencoProdottoPos.Count().ToString() Elementi presenti
			    </td>
		    </tr>
	    </tfoot>
        <tbody>
            @foreach (MyProdottoPos map in Model.ElencoProdottoPos)
            { 
                <tr>
                    <td >
                      <table>
                        <tr><td align="center" >@CounterValue()</td></tr>      
                        <tr><td align="center"><input type="checkbox" name="multicheckSelect" value="@map.ProdottoPos_id" @IsEditableString()/></td> 
                        </tr>
                     </table>
                   </td>
                    <td class="align-center" >@* Fase *@
                    @if (@IsEditable)
                    {  
                        @*@Html.DropDownList("Fase", map.ProdottoPos_ListaFasiSL, null, new { style = "width:120px", id = "Fase_" + @map.ProdottoPos_id.ToString() })*@
                        @Html.DropDownList("Fase", ListaFasiSL(map.ProdottoPos_Fase_id), null, new { style = "width:120px", id = "Fase_" + @map.ProdottoPos_id.ToString() })
                    }
                    else
                    { 
                        @*@Html.DropDownList("Fase", map.ProdottoPos_ListaFasiSL, null, new { style = "width:120px", id = "Fase_" + @map.ProdottoPos_id.ToString(), disabled = "disabled" })*@
                        @Html.DropDownList("Fase", ListaFasiSL(map.ProdottoPos_Fase_id), null, new { style = "width:120px", id = "Fase_" + @map.ProdottoPos_id.ToString(), disabled = "disabled" })
                    }
                    </td>
                    <td class="align-center" > @* AnalisiIntermedio *@
                        <table >
                            <tr style ="width :100%" >
                                <td width="90%" rowspan="2"><span>
                                    <label ><a href="javascript:openAnalisiDettRO('/Prodotto/PPIntermAnalisiDettRO/@map.ProdottoPos_id')" id="closePopUpAnalisi" title="Dettaglio" ><span id="@contact("ProdottoPos_Analisi_desc", @map.ProdottoPos_id)" >@map.ProdottoPos_Analisi_Desc </span></a> </label> 
                                    <input type="hidden" id="@contact("ProdottoPos_Analisi_id", @map.ProdottoPos_id)" value="@map.ProdottoPos_Analisi_id"/></span></td>
                                <td width="10%">
                                    @if (@IsEditable)
                                    {<a id="@contact("ProdottoPos_Analisi_img", @map.ProdottoPos_id)"  href="javascript:openRicercaPPIntermProdotto('/Prodotto/PPIntermAnalisi/@map.ProdottoPos_id',this)" title="ricerca" class="button" style="background-image:url(../../Content/img/fineFiles/16/magnify.png);width: 16px;height: 16px; display:block;float:right;padding-right:0px;padding-left:0px" ></a>}
                                </td>
                            </tr> 
                            <tr>
                                <td>
                                @if (@IsEditable)
                                {<a href="javascript:void(0);" id="@contact("clearPPInterAnalisi", @map.ProdottoPos_id)" class="button"  style="background-image:url(../../Content/img/fineFiles/16/clear.png);width: 16px;height: 16px;display:block;float:right;padding-right:0px;padding-left:0px" title="Pulisci" onclick ="clearDataPPProdotto(@map.ProdottoPos_id);" ></a>}</td>
                            </tr>
                            @*<tr>
                                <td><a href="javascript:openAnalisiDettRO('/Prodotto/PPIntermAnalisiDettRO/@map.ProdottoPos_id')" id="closePopUpAnalisi" class="button"  style="background-image:url(../../Content/img/fineFiles/16/text.png);width: 16px;height: 16px;display:block;float:right;padding-right:0px;padding-left:0px" title="Dettaglio" ></a></td>
                            </tr>*@
                        </table>
                    </td> 
                    <td class="align-center" > @* Prodotto *@
                        <table >
                            <tr style ="width :100%" >
                                <td width="90%" rowspan="2"><span>
                                    <label ><a href="javascript:openAnalisiDettRO('/Prodotto/PPProdottiDettRO/@map.ProdottoPos_id')" id="closePopUpProdotti" title="@map.ProdottoPos_Prodotto_Desc" ><span id="@contact("ProdottoPos_Prodotto_Desc", @map.ProdottoPos_id)" >@map.ProdottoPos_Prodotto_Desc</span></a> </label> 
                                    <input type="hidden" id="@contact("ProdottoPos_Prodotto_id", @map.ProdottoPos_id)" value="@map.ProdottoPos_Prodotto_id"/>
                                    <input type="hidden" id="@contact("ProdottoPos_Prodotto_UDM_ID", @map.ProdottoPos_id)" value="@map.ProdottoPos_Prodotto_UDM_id"/>
                                    </span></td>
                                <td width="10%">
                                    @if (@IsEditable)
                                    {<a id="@contact("ProdottoPos_Prodotto_img", @map.ProdottoPos_id)" href="javascript:openRicercaPPProdottiP('/Prodotto/PPProdotti/@map.ProdottoPos_id',this)" title="ricerca" class="button" style="background-image:url(../../Content/img/fineFiles/16/magnify.png);width: 16px;height: 16px; display:block;float:right;padding-right:0px;padding-left:0px" ></a>}
                                </td>
                            </tr> 
                            <tr>
                                <td>@if (@IsEditable)
                                    {<a href="javascript:void(0);" id="@contact("clearPPProdotti", @map.ProdottoPos_id)" class="button"  style="background-image:url(../../Content/img/fineFiles/16/clear.png);width: 16px;height: 16px;display:block;float:right;padding-right:0px;padding-left:0px" title="Pulisci" onclick ="clearDataPopUpProdottiP(@map.ProdottoPos_id);" ></a>}</td>
                            </tr>
                            @*<tr>
                                <td><a href="javascript:openAnalisiDettRO('/Analisi/PPProdottiDettRO/@map.ProdottoPos_id')" id="closePopUpProdotti" class="button"  style="background-image:url(../../Content/img/fineFiles/16/text.png);width: 16px;height: 16px;display:block;float:right;padding-right:0px;padding-left:0px" title="Dettaglio" ></a></td>
                            </tr>*@
                        </table>
                    </td>
                    <td class="align-center" > @* Macchinario *@
                      <table >
                            <tr style ="width :100%" >
                                <td width="90%" rowspan="2"><span>
                                    <label ><a href="javascript:openAnalisiDettRO('/Prodotto/PPMacchinarioDettRO/@map.ProdottoPos_id')"     title="Dettaglio" ><span id="@contact("ProdottoPos_Macchinario_Desc", @map.ProdottoPos_id)" >@map.ProdottoPos_Macchinario_Desc </span></a></label> 
                                    <input type="hidden" id="@contact("ProdottoPos_Macchinario_id", @map.ProdottoPos_id)" value="@map.ProdottoPos_Macchinario_id"/>
                                    </span></td>
                                <td width="10%">
                                    @if (@IsEditable)
                                    {<a  id="@contact("ProdottoPos_Macchinario_img", @map.ProdottoPos_id)" href="javascript:openRicercaPPMacchinarioP('/Prodotto/PPMacchinari/@map.ProdottoPos_id',this)" title="ricerca" class="button" style="background-image:url(../../Content/img/fineFiles/16/magnify.png);width: 16px;height: 16px; display:block;float:right;padding-right:0px;padding-left:0px" ></a>}
                                </td>
                            </tr> 
                            <tr>
                                <td>@if (@IsEditable)
                                    {<a href="javascript:void(0);" id="@contact("clearPPMacchinario", @map.ProdottoPos_id)" class="button"  style="background-image:url(../../Content/img/fineFiles/16/clear.png);width: 16px;height: 16px;display:block;float:right;padding-right:0px;padding-left:0px" title="Pulisci" onclick ="clearDataPopUpMacchinarioP(@map.ProdottoPos_id);" ></a>}</td>
                            </tr>
                            </table> 
                    </td> 
                    <td class="align-center" >@* Livello *@
                       @if (@IsEditable)
                       {
                       @Html.DropDownList("Livello", map.ProdottoPos_ListaFigProfSL, null, new { style = "width:100px", id = "FigProf_" + @map.ProdottoPos_id.ToString() })
                       }
                       else
                       {
                            @Html.DropDownList("Livello", map.ProdottoPos_ListaFigProfSL, null, new { style = "width:100px", id = "FigProf_" + @map.ProdottoPos_id.ToString(), disabled = "disabled" })
                       }
                        @*@Html.DropDownListFor(modelItem => map.AnalisiPos_ListaFigProf ,map.AnalisiPos_ListaFigProfSL)*@
                    </td>
                    <td class="align-center">
                        @if (@IsEditable)
                        { @Html.TextBox("Descrizione", map.ProdottoPos_desc, new { Class = "input", id = "ProdottoPos_Desc_" + @map.ProdottoPos_id.ToString(), Style = "width:150px", @onmouseover = "posDescIn(this," + @map.ProdottoPos_id + ");", @onmouseout = "posDescOut(this);" })
                        }
                        else
                        { 
                            @Html.TextBox("Descrizione", map.ProdottoPos_desc, new { Class = "input", id = "ProdottoPos_Desc_" + @map.ProdottoPos_id.ToString(), Style = "width:150px", disabled = "disabled", @onmouseover = "posDescIn(this," + @map.ProdottoPos_id + ");", @onmouseout = "posDescOut(this);" })
                        }
                    </td>
                    <td class="align-center" >@* UdM *@
                        <input type="hidden" id=@contact("UdMOLD", @map.ProdottoPos_id) value="@getIntValue(map.ProdottoPos_UdM_id)"  />
                     @if (@IsEditable)
                     {
                         <div id=@contact("onm", @map.ProdottoPos_id) name="onm" onmouseover = "udmCoeffValIn(this,@map.ProdottoPos_id,'@map.ProdottoPos_Prodotto_UDM_Desc');" onmouseout = "udmCoeffValOut(this);" style ="width: 50px;height: 10px; display:block;float:right;padding-right:0px;padding-left:0px;text-align:right">
                         * 
                         </div>
                        <img id=@contact("imgUdM", @map.ProdottoPos_id) alt="Errore" src="../../Content/img/fineFiles/16/required_field.gif" style ="width: 16px;height: 16px; display:block;float:right;padding-right:0px;padding-left:0px"/>
                        @*@Html.DropDownList("UdM", map.ProdottoPos_ListaUdMSL, null, new { style = "width:50px", id = "UdM_" + @map.ProdottoPos_id.ToString(), @onmouseover = "udmCoeffValIn(this," + @map.ProdottoPos_id + ",'" + @map.ProdottoPos_Prodotto_UDM_Desc + "');", @onmouseout = "udmCoeffValOut(this);" })*@
                         @Html.DropDownList("UdM", ListaUdMSL(@map.ProdottoPos_UdM_id), null, new { style = "width:50px", id = "UdM_" + @map.ProdottoPos_id.ToString(), @onmouseover = "udmCoeffValIn(this," + @map.ProdottoPos_id + ",'" + @map.ProdottoPos_Prodotto_UDM_Desc + "');", @onmouseout = "udmCoeffValOut(this);" })
                        <a id=@contact("aUdM", @map.ProdottoPos_id)  href="javascript:openPPUDMP('/Prodotto/PPUdMConversione/@map.ProdottoPos_id',this)" title="ricerca" class="button" style="background-image:url(../../Content/img/fineFiles/16/magnify.png);width: 16px;height: 16px; display:block;float:right;padding-right:0px;padding-left:0px" ></a>
                        <input type="hidden" id=@contact("UdMCoeff", @map.ProdottoPos_id) value="@GetConversione(@map.ProdottoPos_CoeffConversione)" />
                        <input type="hidden" id=@contact("UdMProdotDesc", @map.ProdottoPos_id) value="@map.ProdottoPos_Prodotto_UDM_Desc" />
                     }
                     else
                     { 
                       @*@Html.DropDownList("UdM", map.ProdottoPos_ListaUdMSL, null, new { style = "width:50px", id = "UdM_" + @map.ProdottoPos_id.ToString(), disabled = "disabled" })*@
                         <div>
                       @if (@map.ProdottoPos_CoeffConversione != 1)
                       {
                       <div id=@contact("onm", @map.ProdottoPos_id) name="onm" onmouseover = "udmCoeffValIn(this,@map.ProdottoPos_id,'@map.ProdottoPos_Prodotto_UDM_Desc');" onmouseout = "udmCoeffValOut(this);" style ="width: 50px;height: 10px; display:block;float:right;padding-right:0px;padding-left:0px;text-align:right">
                       *
                       </div>
                       }
                         @Html.DropDownList("UdM", ListaUdMSL(@map.ProdottoPos_UdM_id), null, new { style = "width:50px", id = "UdM_" + @map.ProdottoPos_id.ToString(), disabled = "disabled" })
                          </div>
                         <input type="hidden" id=@contact("UdMCoeff", @map.ProdottoPos_id) value="@GetConversione(@map.ProdottoPos_CoeffConversione)" />
                        <input type="hidden" id=@contact("UdMProdotDesc", @map.ProdottoPos_id) value="@map.ProdottoPos_Prodotto_UDM_Desc" />
                      
                     }
                    </td>
                    <td class="align-center">
                        <span class="number input">
                        @*<button type="button" class="button number-down" @IsEditableString() >-</button>*@
                        <input type="text" name="special-input-2" id=@contact("ProdottoPos_Quantita", @map.ProdottoPos_id)  class="input-unstyled" style="width:50px" value="@map.ProdottoPos_Quantita.ToString()"  data-number-options='{"min":0,"increment":1,"precision":0.00001}' @IsEditableString()/>
				        @*<button type="button" class="button number-up" @IsEditableString()>+</button>*@
				        </span>
                    </td>
                     <td class="align-center">
                     @if (@IsEditable)
                     {
                       <div id=@contact("cstun", @map.ProdottoPos_id) name="cstun" onmouseover= "CstUnitCondIn(this, @map.ProdottoPos_id)" onmouseout = "CstUnitCondOut(this);" style ="width: 45px;height: 10px; display:block;float:right;padding-right:0px;padding-left:0px;text-align:right">
                       *
                       </div>
                     }
                     else
                     {

                         if (@map.ProdottoPos_CoeffConversione != 1)
                         {
                       <div id=@contact("cstun", @map.ProdottoPos_id) name="cstun" onmouseover= "CstUnitCondIn(this, @map.ProdottoPos_id)" onmouseout = "CstUnitCondOut(this);" style ="width: 45px;height: 10px; display:block;float:right;padding-right:0px;padding-left:0px;text-align:right">
                       *
                       </div>
                         }
                     } 
                        <input type="text" name=@contact("Costo_Unitario", @map.ProdottoPos_id) id="@contact("Costo_Unitario", @map.ProdottoPos_id)" class="input" value="@SetImporto(map.ProdottoPos_QuantitaCosto)" disabled=""  style ="width:45px;text-align :right;"/>
                     </td> 
                     <td class="align-center">
                        <input type="text" name=@contact("Costo_Totale", @map.ProdottoPos_id) id="@contact("Costo_Totale", @map.ProdottoPos_id)" class="input" value="@SetImporto(map.ProdottoPos_TotCosto)" disabled=""  style ="width:50px;text-align :right;" />
                      </td> 
                </tr>

            }
        </tbody>
    </table>


</div>

   